<?php
defined('BASEPATH') OR exit('No direct script access allowed');

class Admin extends CI_Controller {

    /**
     * Index Page for this controller.
     *
     * Maps to the following URL
     * 		http://example.com/index.php/welcome
     *	- or -
     * 		http://example.com/index.php/welcome/index
     *	- or -
     * Since this controller is set as the default controller in
     * config/routes.php, it's displayed at http://example.com/
     *
     * So any other public methods not prefixed with an underscore will
     * map to /index.php/welcome/<method_name>
     * @see https://codeigniter.com/user_guide/general/urls.html
     */

    public function __construct()
    {
        parent::__construct();
        $this->load->helper('url');
        $this->load->model('admin_model');
    }


    public function index()
    {

        $data['blog_data']=$this->admin_model->get_all_blogs();
        $this->load->view('admin_blog',$data);
    }
    public function blog_add()
{
    $picture_location = $this->store_photo_return_photo_location();
    $insert = $this->admin_model->blog_add($picture_location);
    $this->index();
}
    public function edit_blog($id)
    {
        $data = $this->admin_model->get_by_id($id);



        echo json_encode($data);
}

    public function blog_update()
    {
        $data = array(
            'author' => $this->input->post('author'),
            'title' => $this->input->post('title'),
            'details' => $this->input->post('details'),
            'tag' => $this->input->post('tag'),
        );
        $this->admin_model->blog_update(array('id' => $this->input->post('id')), $data);
        echo json_encode(array("picture" => TRUE));
    }

    public function blog_delete($id)
    {
        $this->admin_model->delete_by_id($id);
        echo json_encode(array("status" => TRUE));
    }





    public function store_photo_return_photo_location()
    {

        /*$name = $_FILES['picture']['name'];
        $name_ext = explode('.',$name );
        $ext = end($name_ext);
        $target_name = uniqid(rand()).".".$ext;
        $target_file = "assets/images/".$target_name;
        $allowed_types = array("jpeg","JPEG","jpg","JPG","gif","GIF","png","PNG");
        $file_type = $_FILES['picture']['type'];

        if(in_array($ext, $allowed_types))
        {
            //if(is_uploaded_file($_FILES['$a']['tmp_name']))

           // {
                if(move_uploaded_file($_FILES['picture']['tmp_name'], $target_file))
                {
                    var_dump($target_file);
                }

                return false;
           // }
        }
        else
        {
            return false;
        } */

        $name = $_FILES['picture']['name'];
        $name_ext = explode('.',$name );
        $ext = end($name_ext);
        $target_name = uniqid(rand()).".".$ext;
        $target_file = "assets/images/".$target_name;
        $allowed_types = array("jpeg","JPEG","jpg","JPG","gif","GIF","png","PNG");
        $file_type = $_FILES['picture']['type'];

        if(in_array($ext, $allowed_types))
        {
            if(is_uploaded_file($_FILES['picture']['tmp_name']))

            {
                if(move_uploaded_file($_FILES['picture']['tmp_name'], $target_file))
                {

                    return $target_file;
                }

                return false;
            }
        }
        else
        {
            return false;
        }
    }


    public function pic_in(){
        // file name
        $filename = $_FILES['picture']['name'];

// Location
        $location = 'assets/images/'.$filename;

// file extension
        $file_extension = pathinfo($location, PATHINFO_EXTENSION);
        $file_extension = strtolower($file_extension);

// Valid image extensions
        $image_ext = array("jpg","png","jpeg","gif");

        $response = 0;
        if(in_array($file_extension,$image_ext)){
            // Upload file
            if(move_uploaded_file($_FILES['picture']['tmp_name'],$location)){
                $response = $location;
            }
        }

        echo $response;
    }



}
